@{
    ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- ====================== -->
<!-- PHẦN TRÌNH CHIẾU (TÙY CHỌN) -->
<!-- ====================== -->


<!-- ====================== -->
<!-- NỘI DUNG CHÍNH -->
<!-- ====================== -->
<section class="content-section">
    <div class="content">

        <!-- 🟢 TAB 1: TỪ VỰNG -->
        <div id="vocab" class="tab active">
            <div class="card">
                <h2>Flashcards của tôi</h2>

                <!-- Flashcard Management -->
                <div class="flashcards-management">
                    <button class="action" onclick="loadFlashcards(1)">🔄 Tải Flashcards</button>
                    <button class="action" onclick="startPractice()">📚 Bắt đầu luyện tập</button>

                    <!-- Page Size Selector -->
                    <div class="page-size-selector" style="display: inline-block; margin-left: 15px;">
                        <label for="pageSize">Hiển thị:</label>
                        <select id="pageSize" onchange="changePageSize(this.value)" style="margin-left: 5px; padding: 5px;">
                            <option value="10">10 thẻ</option>
                            <option value="20">20 thẻ</option>
                            <option value="50">50 thẻ</option>
                            <option value="100">100 thẻ</option>
                        </select>
                    </div>
                </div>

                <!-- Flashcards Grid -->
                <div id="flashcardsGrid" class="flashcards-grid" style="display: none; margin-top: 20px;">
                    <!-- Flashcards will be loaded here -->
                </div>

                <!-- Pagination Container will be inserted here by JavaScript -->
                <!-- Practice Section -->
                <div id="practiceSection" style="display: none; margin-top: 20px;">
                    <div class="practice-container">
                        <!-- Progress Bar -->
                        <div class="progress-section">
                            <div class="progress">
                                <div id="practiceProgress" class="progress-bar" style="width: 0%"></div>
                            </div>
                            <div id="progressText" class="progress-text">0/0</div>
                        </div>

                        <!-- Flashcard Review -->
                        <div id="flashcardReview" class="flashcard-review" style="display: none;">
                            <!-- Add the flip container -->
                            <div class="flip-container">
                                <div class="flipper">
                                    <div class="flashcard-front">
                                        <div class="flashcard">
                                            <h2 id="practiceWord" class="word"></h2>
                                            <p id="practiceMeaning" class="meaning" style="display: none;"></p>
                                            <img id="practiceImage" class="word-image" style="display: none; max-width: 200px; margin: 10px auto;" />
                                        </div>
                                    </div>
                                    <div class="flashcard-back">
                                        <!-- This side remains empty or can show loading -->
                                        <div class="loading-spinner"></div>
                                        <p style="margin-top: 10px; color: #666;">Đang tải từ tiếp theo...</p>
                                    </div>
                                </div>
                            </div>

                            <div class="difficulty-buttons">
                                <h4>Đánh giá độ khó:</h4>
                                <div class="button-group">
                                    <button class="action btn-success" onclick="submitDifficultyWithAnimation('Easy')">Dễ</button>
                                    <button class="action btn-warning" onclick="submitDifficultyWithAnimation('Medium')">Trung bình</button>
                                    <button class="action btn-danger" onclick="submitDifficultyWithAnimation('Hard')">Khó</button>
                                </div>
                            </div>
                        </div>

                        <!-- Exercise Section -->
                        <div id="exerciseSection" class="exercise-section" style="display: none;">
                            <!-- Multiple Choice Exercise -->
                            <div id="multipleChoiceExercise" style="display: none;">
                                <h4>Chọn nghĩa đúng của từ: "<strong id="mcWord"></strong>"</h4>
                                <div id="choicesContainer" class="choices-container"></div>
                                <button class="action" onclick="submitExerciseAnswer()" style="margin-top: 10px;">Kiểm tra</button>
                            </div>

                            <!-- Fill in Blank Exercise -->
                            <div id="fillBlankExercise" style="display: none;">
                                <h4>Điền từ vào chỗ trống:</h4>
                                <p id="fillMeaning" class="meaning"></p>
                                <p id="fillExample" class="example-sentence"></p>
                                <input type="text" id="fillAnswer" placeholder="Điền từ vào chỗ trống..."
                                       class="form-control" style="margin: 10px 0;" />
                                <button class="action" onclick="submitFillAnswer()">Kiểm tra</button>
                            </div>
                        </div>

                        <!-- Add this after the exercise sections but before practiceComplete -->
                        <div id="exerciseFeedback" style="display: none; margin-top: 15px; padding: 10px; border-radius: 5px;">
                            <div id="feedbackMessage"></div>
                            <button id="nextExerciseBtn" class="action" onclick="nextAfterFeedback()" style="margin-top: 10px; display: none;">
                                Tiếp tục
                            </button>
                            <button id="retryExerciseBtn" class="action" onclick="retryExercise()" style="margin-top: 10px; display: none;">
                                Thử lại
                            </button>
                        </div>

                        <!-- Practice Complete -->
                        <div id="practiceComplete" style="display: none; text-align: center;">
                            <h3>🎉 Hoàn thành luyện tập!</h3>
                            <div id="practiceSummary"></div>
                            <button class="action" onclick="resetPractice()">Luyện tập lại</button>
                        </div>

                        <!-- Add retry section at the end -->
                        <div id="retrySection" style="display: none; margin-top: 20px;">
                            <h3>🔁 Ôn tập lại các từ chưa đúng</h3>
                            <div id="retryWordsList"></div>
                            <button class="action" onclick="startRetrySession()">Bắt đầu ôn tập</button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyFlashcards" class="empty-state" style="display: none; text-align: center; margin-top: 20px;">
                    <p>Chưa có flashcard nào. Hãy thêm từ mới để bắt đầu học!</p>
                </div>
            </div>
        </div>

        <!-- TAB NGHE & NÓI -->
        <div id="listening" class="tab">
            <div class="card">
                <h2>Bài nghe & Nói</h2>

                <!-- Bài nghe mẫu -->
                <audio controls>
                    <source src="audio/lesson1.mp3" type="audio/mpeg">
                </audio>
                <br><br>

                <div style="margin-top:15px;">
                    <h3>🔤 Hãy phát âm từ sau:</h3>
                    <div id="randomWord" style="font-size:28px;font-weight:bold;color:#007bff;">(Đang tải...)</div>
                    <button class="action" id="newWordBtn">🎲 Lấy từ mới</button>
                </div>

                <!-- Ghi âm -->
                <button class="action" id="startRecordingBtn">🎤 Bắt đầu ghi âm</button>
                <button class="action" id="stopRecordingBtn" disabled>⏹️ Dừng ghi âm</button>
                <br><br>

                <!-- Nghe lại bản ghi -->
                <audio id="audioPlayer" controls style="display:none;"></audio>

                <!-- Hiển thị kết quả chấm điểm -->
                <div id="speechResult" style="margin-top:10px;"></div>
                <div id="speechStatus" style="margin-top:5px;color:gray;"></div>
            </div>
        </div>

        <!-- 🔵 TAB 3: VIẾT -->
        <div id="writing" class="tab">
            @* <div class="card">
                <h2>Bài viết</h2>
                <textarea id="writingText" rows="5" style="width:100%" placeholder="Nhập đoạn văn cần kiểm tra..."></textarea>
                <button class="action" onclick="checkGrammar()">✅ Kiểm tra lỗi ngữ pháp</button>
            </div> *@

            <!-- ---------- PHẦN OCR / UPLOAD ẢNH ---------- -->
            <div class="card" style="margin-top:16px;">
                <h2>Nhận diện chữ viết tay (OCR)</h2>

                <!-- Nếu bạn dùng ASP.NET MVC với antiforgery, giữ dòng @Html.AntiForgeryToken() -->
                @* Nếu không dùng Razor, xóa dòng dưới *@
                @Html.AntiForgeryToken()

                <div style="display:flex;gap:12px;align-items:center;">
                    <input type="file" id="ocrFile" accept="image/*" />
                    <button id="btnOcr" class="action">🔍 Nhận diện</button>
                    <span id="ocrStatus" style="margin-left:8px;color:#666"></span>
                </div>

                <div id="previewContainer" style="margin-top:10px;">
                    <img id="previewImage" src="" alt="preview" style="max-width:100%; display:none; border:1px solid #ddd; padding:6px; border-radius:4px;" />
                </div>

                <h3 style="margin-top:12px">Kết quả</h3>
                <pre id="ocrResult" style="white-space:pre-wrap; background:#fafafa; padding:12px; border-radius:6px; min-height:60px;"></pre>
            </div>
        </div>

        @* <!-- 🟣 TAB 4: ĐỌC HIỂU -->
        <div id="reading" class="tab">
            <div class="card">
                <h2>Bài đọc</h2>
                <textarea id="readingText" rows="5" style="width:100%" placeholder="Nhập đoạn văn để sinh câu hỏi..."></textarea>
                <button class="action" onclick="generateQuestions()">❓ Tạo câu hỏi trắc nghiệm</button>
            </div>
        </div> *@

        <!-- 🟠 TAB 5: THI THỬ -->
        <div id="exam" class="tab">
            <div class="card">
                <h2>Bài thi</h2>

                <div id="quizContainer">
                    <div id="quizHeader" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <div><strong>Câu <span id="questionNumber">0</span> / <span id="totalQuestions">10</span></strong></div>
                        <div id="quizTimer" style="color:#666; font-size:0.9em"></div>
                    </div>

                    <p id="examQuestion" style="font-weight:600; min-height:48px;">Nhấn "Bắt đầu" để bắt đầu bài thi.</p>

                    <div id="answerButtons" style="display:flex;flex-direction:column;gap:8px; margin-top:8px;">
                        <button class="action answer-btn" data-choice="A" onclick="selectAnswer('A')">A</button>
                        <button class="action answer-btn" data-choice="B" onclick="selectAnswer('B')">B</button>
                        <button class="action answer-btn" data-choice="C" onclick="selectAnswer('C')">C</button>
                        <button class="action answer-btn" data-choice="D" onclick="selectAnswer('D')">D</button>
                    </div>

                    <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                        <button id="startQuizBtn" class="action" onclick="startQuiz()">Bắt đầu</button>
                        <button id="nextBtn" class="action" onclick="nextQuestion()" style="display:none">Tiếp</button>
                        <div id="progressInfo" style="margin-left:12px;color:#666"></div>
                    </div>

                    <div id="quizResult" style="display:none; margin-top:14px;">
                        <h3>Kết quả</h3>
                        <p id="resultText"></p>
                        <button class="action" onclick="startQuiz()">Làm lại</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- 🧠 TAB 6: CHATBOT -->
        <div id="chatbot" class="tab">
            <div class="card">
                <div style="display: flex; gap: 20px; min-height: 500px;">
                    <!-- Chat Sidebar -->
                    <div class="chat-sidebar" style="width: 250px; border-right: 1px solid #eee; padding-right: 15px;">
                        <div style="margin-bottom: 15px;">
                            <button class="action" onclick="createNewChat()" style="width: 100%;">
                                ➕ Cuộc trò chuyện mới
                            </button>
                        </div>

                        <!-- Chat List -->
                        <div id="chatList" class="chat-list"
                             style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                            <!-- Chat items will be loaded here -->
                        </div>

                        <!-- Chat Actions -->
                        <div class="chat-actions" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <button class="action" onclick="exportAllChats()" style="width: 100%; margin-bottom: 8px;">
                                📥 Xuất tất cả
                            </button>
                            <button class="action btn-danger" onclick="deleteAllChats()" style="width: 100%;">
                                🗑️ Xóa tất cả
                            </button>
                        </div>
                    </div>

                    <!-- Main Chat Area -->
                    <div class="chat-main" style="flex: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 id="currentChatTitle">Chatbot hỗ trợ tiếng Anh</h2>
                            <div class="chat-controls">
                                <button class="action" onclick="renameCurrentChat()">✏️ Đổi tên</button>
                                <button class="action" onclick="exportCurrentChat()">📥 Xuất chat</button>
                                <button class="action btn-danger" onclick="deleteCurrentChat()">🗑️ Xóa</button>
                            </div>
                        </div>

                        <!-- User Info -->
                        <div class="user-info-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4>Thông tin người dùng</h4>
                            <div class="user-info-form">
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label for="username">Họ tên</label>
                                        <input type="text" id="username" placeholder="Nhập tên của bạn"
                                               class="form-control" value="" />
                                    </div>
                                    <div>
                                        <button class="action" onclick="updateUserInfo()">Cập nhật</button>
                                    </div>
                                </div>
                                <!-- Hidden gender field - always set to "Other" -->
                                <input type="hidden" id="gender" value="Other" />
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div id="chatMessages" class="chat-messages" style="height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div class="empty-chat" style="text-align: center; color: #666; padding: 40px 20px;">
                                <div style="font-size: 48px;">💬</div>
                                <h4>Chưa có tin nhắn nào</h4>
                                <p>Gửi tin nhắn để bắt đầu trò chuyện!</p>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-form">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="chatInput"
                                       placeholder="Hỏi tôi bất cứ điều gì về tiếng Anh..."
                                       class="form-control" style="flex: 1;" />
                                <button class="action" onclick="sendChatMessage()">
                                    <span>📤 Gửi</span>
                                </button>
                            </div>
                        </div>

                        <!-- Chat Info -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                            <span id="messageCount" class="message-count">💬 0 tin nhắn</span>
                            <span id="chatInfo" class="chat-info" style="color: #666; font-size: 0.9em;"></span>
                        </div>

                        <!-- Chat Suggestions -->
                        <div class="chat-suggestions" style="margin-top: 15px;">
                            <h5>💡 Thử hỏi:</h5>
                            <div class="suggestion-chips" style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Tôi có thể làm gì để cải thiện khả năng phát âm?')">Bí kíp phát âm</button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Khác biệt giữa make và do là gì?')">Hỗ trợ ngữ pháp</button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Bạn có thể cho tôi vài ví dụ để luyện tập giao tiếp không?')">Luyện tập giao tiếp</button>
                                <button type="button" class="suggestion-chip" onclick="useSuggestion('Giải thích cho tôi về thì hiện tại đơn')">Giải thích thì</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 📊 TAB 7: TIẾN ĐỘ -->
        <div id="progress" class="tab">
            <div class="card">
                <h2>Tiến độ học tập</h2>
                <button class="action" onclick="loadProgress()">🔄 Tải tiến độ</button>

                <div class="progress-row" style="margin-top:16px;">
                    <div>
                        <span>Học từ vựng</span>
                        <progress value="70" max="100"></progress>
                        <span>70%</span>
                    </div>
                    <div>
                        <span>Luyện nghe</span>
                        <progress value="50" max="100"></progress>
                        <span>50%</span>
                    </div>
                    <div>
                        <span>Luyện viết</span>
                        <progress value="30" max="100"></progress>
                        <span>30%</span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</section>
@* 
Scripts {
    <script src="~/js/main.js"></script>
} *@


